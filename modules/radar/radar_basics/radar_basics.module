<?php
/**
 * @file
 * Code for the Radar Basics feature.
 */

include_once 'radar_basics.features.inc';

/**
 * Implements hook_date_format_types().
 */
function radar_basics_date_format_types() {
  return array(
    'radar_time' => t('Time'),
    'radar_day' => t('Day'),
  );
}

/**
 * Implements hook_date_formats() {
 */
function radar_basics_date_formats() {
  return array(
    array(
      'type' => 'radar_day',
      'format' => 'l j F',
      'locales' => array(),
    ),
    array(
      'type' => 'radar_time',
      'format' => 'H:i',
      'locales' => array(),
    ),
  );
}

/**
 * Implements hook_pathauto_alias_alter().
 *
 * Seems our widget supplying og entityreference sequentially indexed from 0;
 * so tokens relying on the first reference being index 0 don't work.
 */
function radar_basics_pathauto_alias_alter(&$alias, $context) {
  if ($context['module'] == 'node' && ($context['type'] == 'event' || $context['type'] == 'event_ical_importer')) {
    $node =& $context['data']['node'];
    if (empty($node->og_group_ref)) {
      $alias = 'awaiting-group-confirmation/' . $alias;
    }
    else {
      $node->og_group_ref[LANGUAGE_NONE] = array_values($node->og_group_ref[LANGUAGE_NONE]);
      $alias = token_replace($context['pattern'], $context['data'], array(
        'sanitize' => FALSE,
        'clear' => TRUE,
        'callback' => 'pathauto_clean_token_values',
        'language' => (object) array('language' => $context['language']),
        'pathauto' => TRUE,
      ));
    }
  }
}
